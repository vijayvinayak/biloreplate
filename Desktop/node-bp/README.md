# nodejs-nodatabase-template

## **SUMMARY**

A template for deploying an application backend without database into a Node.JS environment.

## **FEATURES**

### **Legend:**
- :white_check_mark: Ready
- :x: Not ready yet
- :warning: To be tested and discussed

### **Docker File**

- :white_check_mark:  Dockerfile contains the steps to build the docker image. It should describe the base docker image, the steps to copy and package the application

### **Package.json**

This file contains the devdependencies and dependencies. it should contain the script part that define the following tasks
- :white_check_mark: start: command to start the application
- :white_check_mark: test: command to execute the test cases
- :white_check_mark: coverage: and also should include the coverage
- :white_check_mark: pack: command to package the application
- :white_check_mark: deploy: command to deploy with CI the application
- :white_check_mark: lint: to execute the eslint command
- :white_check_mark: lint-fix: to execute the eslint command with 'fix errors' functionality

### **Linters**

- :white_check_mark: .eslintrc (eslint rules)
- :white_check_mark: .eslinignore
- :white_check_mark: .prettierrc (prettier rules)
- :white_check_mark: .prettierignore
- :white_check_mark: .dockerignore
- :white_check_mark: .editorconfig
- :white_check_mark: .gitattributes

### **Testing Framework**

Jest will be used. https://jestjs.io/

- :white_check_mark: Jest packages needs to be included in package.json
- :white_check_mark:  Basic unit test structure needs to be defined.
- :white_check_mark: Needs to have sample unit test cases for reference
- :white_check_mark: Coverage > 90% in sonar

### **Folder Structure**

The following Folder Structure will be used

- :white_check_mark: src: the main code base
- :white_check_mark: logs: log folder
- :white_check_mark: coverage: tests results (vizualization)
- :white_check_mark: node_modules: dependent libraries
- :white_check_mark: test: unit test cases
- :white_check_mark: config: for config files
- :white_check_mark: deployment: for storing CI/CD related files

### **Files in the main list**

- :white_check_mark: .eslintrc: eslint rules
- :white_check_mark: .gitignore: ignore files from git
- :white_check_mark: Dockerfile: the docker image creation file
- :white_check_mark: jest.config.js: jest config file
- :white_check_mark: package.json: main package file

### **Swagger**
- :white_check_mark: examples for /health and root (/docs)

### **Error handling**
- :white_check_mark: error details for dev environment
- :white_check_mark: short error messages for prod environment

### **Request validation**
- :x: No user input

### **Cors headers**
- :white_check_mark: cors headers added

### **Config management**
- :white_check_mark: Default values in config/config.js + env variables in .env (gitignored) + env variables in config.json added at deployment
- :white_check_mark: path to config.json is env variable

### **Logging**
- :white_check_mark: console logging
- :white_check_mark: error logging to file (with flag in config/env)
- :white_check_mark: all events logging to file if required
- :white_check_mark: path to logs is env variable

### JWT management
- :warning: added optonal jwt autorization

### Folder structure
    - config
        conf.js
        config.json (dummy, not used)
    - coverage
        (autogenerated UI for coverage vizualization, gitignored)
    - logs
        (log files, autogenerated, gitignored)
    - node_modules
        (dependency libraries, auto generated by 'npm install' or 'npm ci', gitignored)
    - src
        - controllers
            index.js
            <name>.controller.js
            ...
        - docs
            component.yml
            swaggerTemplate.js
        - errors
            index.ts
            <error class>-error.js
            ...
        - helpers
            index.js
            (common static methods)
        - lib
            service.js (parent class for services)
            validation-handler.js
        - middleware
            - auth
                auth.middleware.js (jwt tokens, authorization)
            (other middleware files)
        - routes
            index.js
            ...
        - services
            index.js
            <name>.service.js
            ...
        app.js
        dependency.js
    - test
        - helpers
        - unit
            - controllers
                ...
            - errors
                ...
            - helpers
                ...
            - lib
                ...
            - middleware
                ...
            - routes
                ...
            - services
                ...
            dependency.test.js
    .dockerignore
    .editorconfig
    .eslinignore
    .eslintrc (eslint rules)
    .gitattributes
    .gitignore
    .gitlab-ci.yml
    .prettierrc (prettier rules)
    .prettierignore
    Dockerfile
    jest.config.js
    package-lock.json
    package.json
    README.md

### Config variables


| Variable | Description | Usage | Default value |
| :--- | :--- | :--- | :--- |
| CONFIG_PATH |	Path to file config.json | 	Input at deployment stage as process.env | 	/ |
| LOG_PARENT_PATH<br>log_parent_path |	Path to /logs folder | 	Input at deployment stage as process.env | 	. |
| PORT <br> port | 	Port the application is listening on | Input at deployment stage as process.env OR<br>set in config.json | 3000 |
|EXTERNAL_URL<br>external_url|	Public address of application without protocol but with port|Input at deployment stage as process.env OR<br>set in config.json|	localhost|
|EXTERNAL_SCHEMA<br>external_schema|Protocol of public URL of the application|Input at deployment stage as process.env OR<br>set in config.json|https://|
|AUTH<br>auth|	Turn on / off OpenID authorization|Input at deployment stage as process.env OR<br>set in config.json|	false|
|AUTH_ISSUER<br>auth_issuer|OpenID Connect Discovery parameters, https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata, issuer.|Input at deployment stage as process.env OR<br>set in config.json||
|AUTH_PUBLIC_KEY_URI<br>auth_public_key_uri|	OpenID Connect Discovery parameters, https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata, jwks-uri|Input at deployment stage as process.env OR<br>set in config.json||
|AUTH_IDLE_TIMEOUT<br>auth_idle_timeout|limit of time for waiting of auth server response, seconds|Input at deployment stage as process.env OR<br>set in config.json|	30|
|SERVER_TIMEOUT_MS | limit of time for waiting of server response, ms|Input at deployment stage as process.env|180000|
|HEADER_ACCESS_CONTROL_ALLOW_ORIGIN<br>HEADER_ACCESS_CONTROL_ALLOW_ORIGIN|	CORS allowed origins|Input at deployment stage as process.env OR<br>set in config.json||
|HEADER_ACCESS_CONTROL_ALLOW_HEADERS<br>HEADER_ACCESS_CONTROL_ALLOW_HEADERS|CORS allowed headers|Input at deployment stage as process.env OR<br>set in config.json|Origin, X-Requested-With, Content-Type, Accept, Authorization|
|HEADER_ACCESS_CONTROL_ALLOW_METHODS<br>HEADER_ACCESS_CONTROL_ALLOW_METHODS|CORS allowed methods|Input at deployment stage as process.env OR<br>set in config.json|GET, POST, PATCH, PUT, DELETE, OPTIONS|
|ERROR_DETAILS<br>error_details|	If true error details will be returned to front-end|Input at deployment stage as process.env OR<br>set in config.json|	false|
|LOG_TO_FILE<br>log_to_file|If true logs will be written to files else to console only|Input at deployment stage as process.env OR<br>set in config.json|	true|
|LOG_TO_FILE_LEVEL<br>log_to_file_level|	Level of logs|Input at deployment stage as process.env OR<br>set in config.json|	error|
|DEBUG<br>debug|	Level of console logger|Input at deployment stage as process.env OR<br>set in config.json. If * OR true OR debug THEN level=debug ELSE level=info|	false|


## **LOCAL TESTING**

1. cd \<project directory\>
2. npm install
3. npm run dev

4. open swagger interface on localhost:3000/docs in your browser
5. get all users from mongo using SwaggerUI as USER -> GET -> /user -> TryItOut -> Execute